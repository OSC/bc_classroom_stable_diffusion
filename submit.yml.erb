<%
  err_msg = "You are not a part of any classroom project. Restarting your web \
  server in the help menu may fix the issue. You may also have to wait if you've \
  recently been added to the project. Reach out to your instructor or \
  contact support through the help menu."

  raise StandardError, err_msg  if classroom == 'no_classroom'

  mounts = {
    'home'    => OodSupport::User.new.home,
    'support' => OodSupport::User.new('support').home,
    'project' => '/ess/project',
  }

  container_sizes = {
    'art': {
      'memory': 2
    },
  }

-%>

---
batch_connect:
  template: "basic"
script:
  accounting_id: "<%= account %>"
  wall_time: "<%= time.to_f * 3600 %>"
  native:
    container:
      name: "stable-diffusion"
      image: "docker-registry.osc.edu/ondemand/ondemand-base-rhel7:0.10.0"
      image_pull_policy: "IfNotPresent"

      restart_policy: 'OnFailure'
      env:
        KUBECONFIG: "/dev/null"
        HOME: "/stable-diffusion"
      port: "8080"
      memory: "<%= container_sizes[size.to_sym][:memory] %>Gi"
    node_selector:
      cluster: 'kubernetes'
    mounts: [
      type: 'host',
      name: '/users/PZS0714/travert/ondemand/dev/bc_osc_stable_diffusion'
    command: ["/bin/bash","-l","<%= staged_root %>/launch.py"]
    ]

